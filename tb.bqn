#!/usr/bin/env BQN

tc â† â€¢Import "bqn-twitch.bqn"

usn â† "olab0t"
uat â† tc.GetEnvVar "OLAB0T_USER_ACCESS_TOKEN"
ch â† "#chess"
cap â† "membership"â€¿"tags"â€¿"commands"

# buffers
c â† 512â¥Š@ # input buffer for reads
fm â† âŸ¨âŸ© # holds list of full messages
lo â† "" # holds left over messages

s â† ch tc.Join cap tc.RequestCap tc.Connect usnâ€¿uat

MainLoop â† {
  fmâ€¿lo â†© lo tc.ReadFullMsgs c tc.Read ğ•©
  tc.HandleMsgâŸœğ•©âˆ˜tc.MsgÂ¨ fm
  ğ•©
}

MainLoop â€¢_while_ 1 s

tc.Disconnect s

